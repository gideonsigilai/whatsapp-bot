name: CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  build:
    name: Build & Lint
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Bun
        uses: oven-sh/setup-bun@v2
        with:
          bun-version: latest

      - name: Install dependencies
        run: bun install --frozen-lockfile

      - name: Verify project files
        run: |
          echo "ðŸ“ Checking project structure..."
          test -f index.js        && echo "  âœ… index.js"
          test -f wa-client.js    && echo "  âœ… wa-client.js"
          test -f db.js           && echo "  âœ… db.js"
          test -f routes/api.js   && echo "  âœ… routes/api.js"
          test -f routes/hooks.js && echo "  âœ… routes/hooks.js"
          test -f public/index.html && echo "  âœ… public/index.html"
          test -f public/docs.html  && echo "  âœ… public/docs.html"
          test -f public/style.css  && echo "  âœ… public/style.css"
          test -f public/app.js     && echo "  âœ… public/app.js"

      - name: Check syntax (Bun)
        run: |
          echo "ðŸ” Checking JavaScript syntax..."
          bun build index.js --outdir /tmp/build --target node 2>&1
          echo "  âœ… No syntax errors"

      - name: Validate package.json
        run: |
          echo "ðŸ“¦ Checking package.json..."
          node -e "
            const pkg = require('./package.json');
            const required = ['name', 'version', 'main', 'scripts'];
            required.forEach(k => {
              if (!pkg[k]) throw new Error('Missing: ' + k);
              console.log('  âœ… ' + k + ': ' + (typeof pkg[k] === 'object' ? JSON.stringify(pkg[k]) : pkg[k]));
            });
          "
